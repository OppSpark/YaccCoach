# 4주차 개발 보고서 - 2025년 04월 01일

## 진행 사항

### 1. 사용자 질병 정보 API 개발 완료
- **GET /disease**: 사용자의 질병 목록 조회 기능 구현
- **POST /disease**: 질병 추가 기능 개발
- **PUT /disease**: 질병명 수정 기능 추가
- **DELETE /disease**: 질병 삭제 기능 개발
- 모든 요청에서 필수 파라미터 검증, 유효성 검사, DB 오류 처리 등 예외 처리를 강화
- 오류 발생 시 `result`와 `message`를 포함한 일관된 JSON 구조로 응답

### 2. 사용자 선호도 정보 API 개발 완료
- **GET /preference**: 선호 기업 목록 페이징 조회
- **POST /preference**: 선호 기업 등록
- **PUT /preference**: 선호 기업 수정
- **DELETE /preference**: 선호 기업 삭제
- 질병 API와 동일하게 모든 예외 처리 및 오류 메시지 구조 통일

### 3. MySQL 세션 기반 인증 로직 완성
- 로그인 시 사용자 정보를 세션에 저장하여 인증 상태 유지
- 이메일 및 비밀번호 유효성 검사 강화
- bcrypt + pepper를 통한 비밀번호 안전 저장
- 로그인 성공 시 세션에 `user_id`, `username`, `email` 저장
- 인증이 필요한 API에서는 `isLoggedIn` 미들웨어로 로그인 상태 확인

### 4. 세션 기반 인증 통합 API 구성
- 로그인, 로그아웃, 사용자 인증 확인 API를 통합적으로 구성
- **POST /verifyUser**를 통해 클라이언트에서 사용자 인증 여부 확인 가능
- 세션 오류, 만료 등도 명확한 메시지로 응답 처리

### 5. API 오류 처리 체계 개선
- 질병 및 선호도 관련 API 8종(GET/POST/PUT/DELETE)에 대해 전체 예외 처리 구조 개선
  - 필수 파라미터 누락
  - 잘못된 입력 형식
  - MySQL 오류 (중복, 길이 초과, 외래키 제약 등)
  - 데이터 없음 → 404 응답
- 모든 API는 `result`, `message`를 포함하는 JSON 응답 형식으로 통일

### 6. 회원 정보 수정 기능 구현
- **PUT /user**: 사용자의 이름, 이메일, 전화번호, 주소, 개인정보동의 값을 수정할 수 있도록 API 구현
- 입력값 유효성 검사 강화: 이메일, 전화번호, 주소 형식 검증
- MySQL의 UNIQUE 제약 조건에 따른 중복 이메일/전화번호 에러를 처리하여 명확한 피드백 제공
- 응답 형식을 기존 API와 일관되게 유지 (`result`, `message` 포함)

### 7. 비밀번호 변경 기능 구현
- **PUT /changePassword**: 사용자 비밀번호를 현재 비밀번호와 새 비밀번호를 기반으로 안전하게 변경
- 현재 비밀번호 일치 여부를 bcrypt로 확인 후 변경 가능
- 새 비밀번호의 형식 검증 및 기존 비밀번호와 중복 방지 로직 추가
- 업데이트 결과 확인 후 처리 성공/실패 여부 반환

### 8. 미들웨어 파일 구조 정리
- 인증 관련 미들웨어(`isLoggedIn`)를 `service/authMiddleware.js`로 분리하여 관리
- 전역 미들웨어, 인증 전용 미들웨어 등 역할에 따라 구조를 모듈화
- 각 라우터 파일에서 필요한 미들웨어를 명확하게 import하여 재사용성 및 유지보수성 향상
- 추후 인증 외 미들웨어(`errorHandler`, `requestLogger` 등) 추가 확장 가능하도록 구조 설계

### 9. 브랜치 전략 유지
- `dev` 브랜치 기반으로 기능 개발 진행
- 안정화 후 `main` 브랜치로 병합 예정